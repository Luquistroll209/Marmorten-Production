{% extends 'blog/base.html' %}
{% load static %}
{% load custom_filters %} 

{% block title %}Sobre Nosotros - {{ config.titulo_sitio }}{% endblock %}

{% block content %}
<style>
  :root {
    /* Paleta de colores consistente */
    --color-primario: #0a0a0a;
    --color-secundario: #121212;
    --color-borde-suave: rgba(255, 255, 255, 0.1);
    --color-texto-principal: #ffffff;
    --color-texto-secundario: #e0e0e0;
    --color-destacado: #c0c0c0;
    --color-destacado-hover: #ffffff;
    --color-tarjeta-oscura: #1e1e1e;
    --color-texto-fondo: rgba(18, 18, 18, 0.92);
    --color-overlay: rgba(10, 10, 10, 0.7);
    
    --radio-borde-grande: 20px;
    --radio-borde-pequeno: 10px;
    --sombra-intensa: 0 12px 40px rgba(0, 0, 0, 0.25);
    --sombra-intensa-hover: 0 16px 50px rgba(0, 0, 0, 0.35);
    --transicion-suave: all 0.5s cubic-bezier(0.22, 1, 0.36, 1);
    --transicion-rapida: all 0.3s ease-out;
  }

  /* Carrusel Hero - Estilo similar al index */
  .hero-carousel-container {
    width: 100%;
    position: relative;
    overflow: hidden;
    margin: 0;
    border-radius: 0;
    height: 100vh;
    max-height: 100vh;
    min-height: 600px;
    margin-bottom: clamp(60px, 8vw, 100px);
  }

  .hero-carousel {
    width: 100%;
    height: 100%;
    position: relative;
  }

  .carousel-inner {
    display: flex;
    height: 100%;
    transition: transform 0.8s cubic-bezier(0.16, 1, 0.3, 1);
    will-change: transform;
  }

  .carousel-slide {
    min-width: 100%;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  .carousel-bg-image {
    position: absolute;
    width: 100%;
    height: 100%;
    object-fit: cover;
    filter: blur(50px) brightness(0.6);
    transform: scale(1.1);
    z-index: 1;
    transition: filter 0.8s ease;
  }

  .carousel-slide.active .carousel-bg-image {
    filter: blur(80px) brightness(0.7);
  }

  .carousel-content {
    display: flex;
    width: 90%;
    max-width: 1400px;
    margin: 0 auto;
    position: relative;
    z-index: 3;
    align-items: center;
    gap: clamp(30px, 4vw, 60px);
    padding: 40px 0;
  }

  .carousel-text {
    flex: 1;
    background-color: var(--color-texto-fondo);
    padding: clamp(30px, 4vw, 60px);
    border-radius: var(--radio-borde-grande);
    backdrop-filter: blur(8px);
    -webkit-backdrop-filter: blur(8px);
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: var(--sombra-intensa);
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.3s;
  }

  .carousel-slide.active .carousel-text {
    transform: translateY(0);
    opacity: 1;
  }

  .carousel-image-container {
    flex: 1;
    position: relative;
    height: clamp(300px, 50vh, 500px);
    border-radius: var(--radio-borde-grande);
    overflow: hidden;
    box-shadow: var(--sombra-intensa);
    border: 1px solid rgba(255, 255, 255, 0.1);
    transform: translateY(20px);
    opacity: 0;
    transition: all 0.8s cubic-bezier(0.16, 1, 0.3, 1) 0.5s;
  }

  .carousel-slide.active .carousel-image-container {
    transform: translateY(0);
    opacity: 1;
  }

  .carousel-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    transition: transform 1.2s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .carousel-slide.active .carousel-image {
    transform: scale(1.03);
  }

  .carousel-title {
    font-size: clamp(2.5rem, 5vw, 4rem);
    margin-bottom: clamp(15px, 2vw, 25px);
    color: var(--color-texto-principal);
    line-height: 1;
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .carousel-description {
    color: var(--color-texto-secundario);
    margin-bottom: clamp(20px, 3vw, 40px);
    font-size: clamp(1rem, 1.2vw, 1.2rem);
    line-height: 1.8;
    max-width: 600px;
  }

  /* Controles del carrusel */
  .carousel-nav {
    position: absolute;
    top: 50%;
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 clamp(20px, 4vw, 40px);
    transform: translateY(-50%);
    z-index: 10;
    pointer-events: none;
  }

  .carousel-btn {
    width: clamp(50px, 5vw, 70px);
    height: clamp(50px, 5vw, 70px);
    border-radius: 50%;
    background: rgba(0,0,0,0.3);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--color-destacado);
    font-size: clamp(1.5rem, 2vw, 1.8rem);
    cursor: pointer;
    transition: var(--transicion-suave);
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: auto;
  }

  .carousel-btn:hover {
    background: rgba(255,255,255,0.2);
    color: var(--color-destacado-hover);
    transform: scale(1.1);
    border-color: rgba(255, 255, 255, 0.4);
  }

  .carousel-indicators {
    position: absolute;
    bottom: clamp(30px, 5vw, 60px);
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 15px;
    z-index: 10;
  }

  .carousel-indicator {
    width: clamp(10px, 1.5vw, 14px);
    height: clamp(10px, 1.5vw, 14px);
    border-radius: 50%;
    background: rgba(255,255,255,0.2);
    border: 1px solid rgba(255,255,255,0.4);
    cursor: pointer;
    transition: var(--transicion-suave);
  }

  .carousel-indicator.active {
    background: var(--color-destacado);
    transform: scale(1.3);
    border-color: var(--color-destacado);
  }

  /* Resto de estilos (secciones de contenido, galería, etc.) */
  /* ... (mantén el resto de tus estilos existentes) ... */

  @media (max-width: 992px) {
    .carousel-content {
      flex-direction: column;
      gap: 40px;
    }
    
    .carousel-text {
      order: 2;
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
    }
    
    .carousel-image-container {
      order: 1;
      width: 100%;
      max-width: 600px;
    }
  }

  @media (max-width: 768px) {
    .hero-carousel-container {
      min-height: 500px;
    }
    
    .carousel-title {
      font-size: clamp(2rem, 6vw, 2.5rem);
    }
    
    .carousel-description {
      font-size: 1rem;
    }
    
    .carousel-text {
      padding: 25px;
    }
    
    .carousel-btn {
      width: 40px;
      height: 40px;
      font-size: 1.2rem;
    }
  }

  @media (max-width: 576px) {
    .hero-carousel-container {
      min-height: 400px;
    }
    
    .carousel-content {
      padding-top: 60px;
      padding-bottom: 60px;
    }
    
    .carousel-indicators {
      bottom: 20px;
    }
  }
</style>

<div class="about-section">
  <!-- Hero Section - Ahora es un carrusel -->
  {% if carrusel_items %}
  <div class="hero-carousel-container">
    <div class="hero-carousel">
      <div class="carousel-inner" id="mainCarousel">
        {% for item in carrusel_items %}
        {% if item.imagen %}
        <div class="carousel-slide {% if forloop.first %}active{% endif %}">
          <img src="{{ item.imagen.url }}" alt="{{ item.titulo }}" class="carousel-bg-image">
          <div class="carousel-content">
            <div class="carousel-text">
              <h1 class="carousel-title">{{ item.titulo }}</h1>
              {% if item.descripcion %}
              <p class="carousel-description">{{ item.descripcion }}</p>
              {% endif %}
            </div>
            <div class="carousel-image-container">
              <img src="{{ item.imagen.url }}" alt="{{ item.titulo }}" class="carousel-image" loading="lazy">
            </div>
          </div>
        </div>
        {% endif %}
        {% endfor %}
      </div>
      
      <div class="carousel-nav">
        <button class="carousel-btn" id="prevBtn" aria-label="Slide anterior">❮</button>
        <button class="carousel-btn" id="nextBtn" aria-label="Slide siguiente">❯</button>
      </div>
      
      <div class="carousel-indicators" id="carouselIndicators">
        {% for item in carrusel_items %}
        <button class="carousel-indicator {% if forloop.first %}active{% endif %}" aria-label="Ir al slide {{ forloop.counter }}"></button>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

  <!-- Resto del contenido (secciones) -->
  {% for seccion in secciones %}
    {% if seccion.tipo == 'TEXTO' %}
      <section class="content-section">
        <div class="section-header">
          <h2 class="section-title">{{ seccion.titulo }}</h2>
          {% if seccion.descripcion %}
          <p class="section-description">{{ seccion.descripcion }}</p>
          {% endif %}
        </div>
        
        <div class="formatted-text">
          {{ seccion.contenido_texto|linebreaks }}
        </div>
      </section>
    
    {% elif seccion.tipo == 'IMAGEN' and seccion.imagen %}
      <div class="featured-image-container" onclick="openImagePopup('{{ seccion.imagen.url }}', '{{ seccion.titulo }}')">
        <img src="{{ seccion.imagen.url }}" alt="{{ seccion.titulo }}" class="featured-image" loading="lazy">
        {% if seccion.titulo %}
        <div class="image-caption">{{ seccion.titulo }}</div>
        {% endif %}
      </div>
    
    {% elif seccion.tipo == 'CAROUSEL' and seccion.imagenes_del_carrusel.all %}
      <section class="content-section">
        <div class="section-header">
          <h2 class="section-title">{{ seccion.titulo }}</h2>
          {% if seccion.descripcion %}
          <p class="section-description">{{ seccion.descripcion }}</p>
          {% endif %}
        </div>
        
        <div class="gallery-container">
          <div class="gallery-grid">
            {% for imagen in seccion.imagenes_del_carrusel.all %}
              {% if imagen.imagen %}
              <div class="gallery-item" onclick="openImagePopup('{{ imagen.imagen.url }}', '{{ imagen.titulo }}')">
                <img src="{{ imagen.imagen.url }}" alt="{{ imagen.titulo|default:'Imagen de galería' }}" class="gallery-image" loading="lazy">
                {% if imagen.titulo %}
                <div class="gallery-caption">{{ imagen.titulo }}</div>
                {% endif %}
              </div>
              {% endif %}
            {% endfor %}
          </div>
        </div>
      </section>
    
    {% elif seccion.tipo == 'REDES' and seccion.enlaces.all %}
      <section class="social-section">
        <div class="section-header">
          <h2 class="section-title">{{ seccion.titulo }}</h2>
          {% if seccion.descripcion %}
          <p class="section-description">{{ seccion.descripcion }}</p>
          {% endif %}
        </div>
        
        <div class="social-grid">
          {% for enlace in seccion.enlaces.all %}
          <a href="{{ enlace.url }}" target="_blank" class="social-card">
            <div class="social-icon">
              {% if enlace.icono %}
                <img src="{{ enlace.icono.url }}" alt="{{ enlace.titulo }}" width="30" height="30">
              {% else %}
                <i class="{{ enlace.get_icon_class }}"></i>
              {% endif %}
            </div>
            <span class="social-title">{{ enlace.titulo|default:enlace.get_tipo_display }}</span>
          </a>
          {% endfor %}
        </div>
      </section>
    {% endif %}
  {% endfor %}
</div>

<!-- Image Popup -->
<div class="image-popup" id="imagePopup">
  <div class="popup-content">
    <button class="close-popup" onclick="closeImagePopup()">&times;</button>
    <img src="" alt="" class="popup-image" id="popupImage">
    <div class="popup-caption" id="popupCaption"></div>
  </div>
</div>

<script>
  // Función para abrir el popup de imagen
  function openImagePopup(imageSrc, caption = '') {
    const popup = document.getElementById('imagePopup');
    const popupImage = document.getElementById('popupImage');
    const popupCaption = document.getElementById('popupCaption');
    
    popupImage.src = imageSrc;
    popupImage.alt = caption;
    popupCaption.textContent = caption;
    
    popup.classList.add('active');
    document.body.style.overflow = 'hidden';
  }
  
  // Función para cerrar el popup
  function closeImagePopup() {
    const popup = document.getElementById('imagePopup');
    popup.classList.remove('active');
    document.body.style.overflow = '';
  }
  
  // Cerrar al hacer clic fuera de la imagen
  document.getElementById('imagePopup').addEventListener('click', function(e) {
    if (e.target === this) {
      closeImagePopup();
    }
  });
  
  // Cerrar con tecla ESC
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeImagePopup();
    }
  });

  // Script para el carrusel hero
  document.addEventListener('DOMContentLoaded', function() {
    const carousel = document.getElementById('mainCarousel');
    const slides = document.querySelectorAll('.carousel-slide');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const indicators = document.querySelectorAll('.carousel-indicator');
    
    let currentIndex = 0;
    let isAnimating = false;
    let autoSlideInterval;
    
    // Inicializar carrusel
    function initCarousel() {
      slides.forEach((slide, index) => {
        if (index === 0) {
          slide.classList.add('active');
        } else {
          slide.classList.remove('active');
        }
      });
      
      if (slides.length > 1) {
        startAutoSlide();
      } else {
        prevBtn.style.display = 'none';
        nextBtn.style.display = 'none';
        document.getElementById('carouselIndicators').style.display = 'none';
      }
    }
    
    // Ir a slide específico
    function goToSlide(index) {
      if (isAnimating || index === currentIndex) return;
      
      isAnimating = true;
      const prevIndex = currentIndex;
      currentIndex = (index + slides.length) % slides.length;
      
      // Actualizar clases de slides
      slides[prevIndex].classList.remove('active');
      slides[currentIndex].classList.add('active');
      
      // Animación suave
      carousel.style.transition = 'transform 0.8s cubic-bezier(0.16, 1, 0.3, 1)';
      carousel.style.transform = `translateX(-${currentIndex * 100}%)`;
      
      // Actualizar indicadores
      updateIndicators();
      
      // Reiniciar autoplay
      resetAutoSlide();
      
      // Finalizar animación
      setTimeout(() => {
        isAnimating = false;
        carousel.style.transition = 'none';
      }, 800);
    }
    
    // Actualizar indicadores
    function updateIndicators() {
      indicators.forEach((indicator, i) => {
        indicator.classList.toggle('active', i === currentIndex);
      });
    }
    
    // Autoplay
    function startAutoSlide() {
      autoSlideInterval = setInterval(() => {
        if (!isAnimating) {
          goToSlide(currentIndex + 1);
        }
      }, 8000);
    }
    
    function resetAutoSlide() {
      clearInterval(autoSlideInterval);
      startAutoSlide();
    }
    
    // Event listeners
    prevBtn.addEventListener('click', () => goToSlide(currentIndex - 1));
    nextBtn.addEventListener('click', () => goToSlide(currentIndex + 1));
    
    indicators.forEach((indicator, index) => {
      indicator.addEventListener('click', () => goToSlide(index));
    });
    
    // Inicializar
    initCarousel();
    
    // Optimización de imágenes
    document.querySelectorAll('img').forEach(img => {
      if (!img.loading) {
        img.loading = 'lazy';
      }
    });
  });
</script>
{% endblock %}